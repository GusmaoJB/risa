% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/hra.R
\name{hra}
\alias{hra}
\title{Habitat Risk Assessment (HRA)}
\usage{
hra(
  raster_list,
  species_distr,
  criteria,
  equation = c("euclidean", "multiplicative"),
  r_max = 3,
  n_overlap = NULL,
  output_decimal_crs = FALSE,
  decay = c("none", "linear", "exponential", "polynomial_2nd", "polynomial_3rd",
    "complementary_decay_2nd", "complementary_decay_3rd"),
  buffer_m = NULL
)
}
\arguments{
\item{raster_list}{A named list of rasters. In single-species mode (depth 2),
it must be \code{list(stressor -> list(attribute -> SpatRaster))}. In ecosystem
mode (depth 3), it must be \code{list(species -> list(stressor -> list(attribute -> SpatRaster)))}.}

\item{species_distr}{A \code{SpatRaster} (single-species) OR a named list of
\code{SpatRaster} objects (ecosystem). If an element is a list, the first
\code{SpatRaster} within it will be used.}

\item{criteria}{A \code{data.frame} (single) OR named list of \code{data.frame}s
(ecosystem) with columns \code{STRESSOR}, \code{ATTRIBUTES}, \code{RATING},
\code{DQ}, \code{WEIGHT}, and \code{E/C}.}

\item{equation}{\code{c("euclidean","multiplicative")}. Selects the InVEST risk
equation used to combine E and C.}

\item{r_max}{Integer in \code{1..10}; maximum score used by the chosen equation.}

\item{n_overlap}{Optional integer: number of stressors assumed to overlap for
classification scaling. By default it is inferred from the criteria.}

\item{output_decimal_crs}{Logical; if \code{TRUE}, reprojects outputs to EPSG:4326.}

\item{decay}{\code{c("none","linear","exponential","polynomial_2nd","polynomial_3rd",
"complementary_decay_2nd","complementary_decay_3rd")}. See \emph{Decay functions}
above. Only the first three are provided by InVEST; the others are extensions.}

\item{buffer_m}{Named numeric vector giving the buffer distance (meters) for each
stressor (e.g., \code{c(stressor1 = 500000, stressor2 = 1000000)}). Required
when \code{decay != "none"} for any stressor you wish to decay.}
}
\value{
An object of class \code{"risaHRA"}: a named list that, for each stressor,
  contains \code{E_criteria}, \code{C_criteria}, \code{Risk_map_raw}, and
  \code{Risk_map}; plus \code{total_raw}, \code{total}, and \code{summary_stats}
  in single-species mode. In ecosystem mode, per-species results are returned,
  along with \code{ecosys_risk_raw}, \code{ecosys_risk_classified}, and a
  combined \code{summary_stats} table.
}
\description{
Implements the Natural Capital Project’s InVEST Habitat Risk Assessment (HRA;
Sharp et al., 2016) model to estimate spatial risk from multiple stressors to
a species/habitat (single-species mode) or across multiple species (ecosystem
mode). For each stressor, the function combines Exposure (E) and Consequence (C)
criteria—mixing mapped rasters and constant scores—using either the Euclidean
or Multiplicative InVEST risk equations (Arkema et al., 2014). Inputs can be
nested lists of rasters (stressor → attributes; or species → stressor → attributes),
a species distribution raster (or list), and a criteria table (or list). Rasters
are auto-aligned to the species grid; outputs include per-stressor E/C maps,
raw and classed risk maps, ecosystem risk (when applicable), and a `summary_stats`
data frame. Optional reprojection to EPSG:4326 is supported.
}
\details{
Rasters are aligned to the species grid using nearest-neighbor for categorical
data and bilinear interpolation for continuous data. When a decay is used and
a buffer is supplied for a given stressor, E and C rasters are attenuated by
the chosen \eqn{f(d)} and an additional "general" decay is applied to overall
stressor occurrence. Cells outside species presence are masked.
}
\section{Decay functions}{

A distance-based decay can be applied to E and C maps (and a general stressor
occurrence decay) when a named buffer (in meters) is supplied for each stressor.
Let \eqn{d} be the distance (in meters) from a cell to the nearest mapped
stressor presence, \eqn{B} the buffer distance for that stressor, and
\eqn{I(d \le B)} an indicator for being within the buffer. The implemented
options are:

\itemize{
  \item \code{"none"} (InVEST): \deqn{f(d) = I(d \le B)}
  \item \code{"linear"} (InVEST): \deqn{f(d) = I(d \le B)\,\left(1 - \frac{d}{B}\right)}
  \item \code{"exponential"} (InVEST): \deqn{f(d) = I(d \le B)\,e^{-k d},\quad k = -\frac{\ln(10^{-6})}{B}}
  \item \code{"polynomial_2nd"} (extension): \deqn{f(d) = I(d \le B)\,\left(1 - \frac{d}{B}\right)^{2}}
  \item \code{"polynomial_3rd"} (extension): \deqn{f(d) = I(d \le B)\,\left(1 - \frac{d}{B}\right)^{3}}
  \item \code{"complementary_decay_2nd"} (extension): \deqn{f(d) = I(d \le B)\,\left(1 - \left(\frac{d}{B}\right)^{2}\right)}
  \item \code{"complementary_decay_3rd"} (extension): \deqn{f(d) = I(d \le B)\,\left(1 - \left(\frac{d}{B}\right)^{3}\right)}
}

\strong{Note:} Only the first three options (\code{"none"}, \code{"linear"},
and \code{"exponential"}) are present in InVEST’s reference implementation.
The polynomial and complementary variants are smooth extensions that allow
faster-than-linear attenuation while remaining bounded in \eqn{[0,1]} on \eqn{[0,B]}.
}

\examples{
# Creating test data
set.seed(12)
spp_df <- rbind(data.frame(long = rnorm(80, 0, 10),
lat = rnorm(80, 0, 10), species = "species1"),
data.frame(long = rnorm(60, 0, 10),
lat = rnorm(60, 0, 10), species = "species2"))
str_df <- rbind(data.frame(long = rnorm(100, 0, 5),
lat = rnorm(100, 0, 10), stressor = "stressor1"),
data.frame(long = rnorm(50, 0, 10),
lat = rnorm(100, 0, 5), stressor = "stressor2"))
# Create kernel maps of species and stressor distributions and overlap maps
risa_maps <- risa_prep(spp_df, str_df)
#Load example data
path <- system.file("extdata", "multi_species_criteria.csv", package = "risa")
df <- read.csv(path)
#Reshape criteria table
crit_list <- criteria_reshape(df)
# Selecting spatially explicit criteria ratings
# Note that the rasters in the stressors's list are named after the respective attribute in the criteria table.
rast_list <- list(
species1 = list(
stressor1 = list(
intensity = risa_maps$stressor_kernel_maps$stressor1$raster,
`likelihood of interaction`=risa_maps$overlap_maps$species1$stressor1$raster),
stressor2 = list(
intensity = risa_maps$stressor_kernel_maps$stressor2$raster,
`likelihood of interaction`=risa_maps$overlap_maps$species1$stressor2$raster)
),
species2 = list(
stressor1 = list(
intensity = risa_maps$stressor_kernel_maps$stressor1$raster,
`likelihood of interaction`=risa_maps$overlap_maps$species2$stressor1$raster),
stressor2 = list(
intensity = risa_maps$stressor_kernel_maps$stressor2$raster,
`likelihood of interaction`=risa_maps$overlap_maps$species2$stressor2$raster)
)
)

# Species' distributions rasters
spp_dist <- list(species1 = risa_maps$species_distributions$species1$raster,
species2 = risa_maps$species_distributions$species2$raster)

# Simple example with one species and one stressor
test1 <- hra(rast_list[[1]], spp_dist[[1]], crit_list[[1]], equation = "euclidean")
terra::plot(test1$total_raw)
test1$summary_stats

# Now with two species and two stressors
many_test <- hra(rast_list, spp_dist, crit_list, equation = "euclidean")
many_test$summary_stats
terra::plot(many_test$species1$total_raw)
terra::plot(many_test$species2$total_raw)
}
\references{
Arkema KK, Verutes G, Bernhardt JR, Clarke C, Rosado S, Canto M, et al. (2014)
Assessing habitat risk from human activities to inform coastal and marine spatial
planning: a demonstration in Belize. \emph{Environmental Research Letters} 9:114016.

Sharp R, Tallis H, Ricketts T, Guerry A, Wood SA, Chaplin-Kramer R, et al. (2016)
InVEST [Internet]. The Natural Capital Project, Stanford University, University of
Minnesota, The Nature Conservancy, and World Wildlife Fund. Available at
\url{http://www.naturalcapitalproject.org/software/}.
}
